DROP DATABASE IF EXISTS projectdb;
CREATE DATABASE projectdb;

USE projectdb;

DROP TABLE IF EXISTS FKHost;
DROP TABLE IF EXISTS FKGuest_List;
DROP TABLE IF EXISTS FKEvent_Venue;
DROP TABLE IF EXISTS FKCust_Address;
DROP TABLE IF EXISTS User;
DROP TABLE IF EXISTS Venue_Address;
DROP TABLE IF EXISTS Event;
DROP TABLE IF EXISTS Cust_Address;

CREATE TABLE Event (
  Event_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
  Title VARCHAR(255),
  Capacity INT,
  StartDate DATE,
  StartTime TIME,
  EndDate DATE,
  EndTime TIME,
  Description TEXT,
  Category VARCHAR(255),
  Ticket_startdate DATE,
  Ticket_enddate DATE,
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE Venue_Address (
  Venue_Address_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
  FirstLine TEXT,
  SecondLine TEXT,
  City VARCHAR(255),
  County VARCHAR(255),
  PostCode VARCHAR(255),
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE User (
  User_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
  Email VARCHAR(255),
  Password VARCHAR(255),
  FirstName VARCHAR(255),
  LastName VARCHAR(255),
  Phone VARCHAR(13),
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE Cust_Address (
  Cust_Address_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
  FirstLine TEXT,
  SecondLine TEXT,
  City VARCHAR(255),
  County VARCHAR(255),
  PostCode VARCHAR(255),
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE FKHost (
   User_ID INT,
   Event_ID INT,
   creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
   modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
   FOREIGN KEY (User_ID) REFERENCES User(User_ID) ON DELETE CASCADE,
   FOREIGN KEY (Event_ID) REFERENCES Event(Event_ID) ON DELETE CASCADE
);

CREATE TABLE FKEvent_Venue (
  Event_ID INT,
  Address_ID INT,
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (Event_ID) REFERENCES Event(Event_ID) ON DELETE CASCADE,
  FOREIGN KEY (Address_ID) REFERENCES Venue_Address(Venue_Address_ID) ON DELETE CASCADE
);

CREATE TABLE FKCust_Address (
  Customer_ID INT,
  Cust_Address_ID INT,
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (Customer_ID) REFERENCES User(User_ID) ON DELETE CASCADE,
  FOREIGN KEY (Cust_Address_ID) REFERENCES Cust_Address(Cust_Address_ID) ON DELETE CASCADE
);

CREATE TABLE FKGuest_List (
  Event_ID INT,
  User_ID INT,
  creation_time      DATETIME DEFAULT CURRENT_TIMESTAMP,
  modification_time  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (Event_ID) REFERENCES Event(Event_ID) ON DELETE CASCADE,
  FOREIGN KEY (User_ID) REFERENCES User(User_ID) ON DELETE CASCADE
);

/* Create User hyminsa */ 
/* Create User hyminsa */ 
/* Create User hyminsa */ 
DROP USER IF EXISTS 'hyminsa'@'localhost';
CREATE USER 'hyminsa'@'localhost' identified by 'hyminsa';
GRANT ALL PRIVILEGES ON projectdb.* to 'hyminsa'@'localhost';

/* DUMMY DATA */
/* DUMMY DATA */
/* DUMMY DATA */
INSERT INTO Event (Title, Capacity, StartDate, StartTime, EndDate, EndTime, Description, Category, Ticket_startdate, Ticket_enddate) 
VALUES ('Dummy event 1', 420, '2017-01-01', '21:00:00', '2017-01-02', '04:00:00', 'Dummy event from 9pm-4am 1st Jan 2017 - 2nd Jan 2017', 'Event', '2017-01-01', '2017-01-02');
INSERT INTO Event (Title, Capacity, StartDate, StartTime, EndDate, EndTime, Description, Category, Ticket_startdate, Ticket_enddate) 
VALUES ('Dummy event 2', 421, '2017-01-02', '21:00:00', '2017-01-03', '04:00:00', 'Dummy event from 9pm-4am 2nd Jan 2017 - 3rd Jan 2017', 'Event', '2017-01-02', '2017-01-03');

INSERT INTO Venue_Address (FirstLine, SecondLine, City, County, PostCode)
VALUES ('1st Dummy Address line 1', '1st Dummy Address line 2', '1st Dummy City', '1st Dummy County', 'WXX XXX');
INSERT INTO Venue_Address (FirstLine, SecondLine, City, County, PostCode)
VALUES ('2nd Dummy Address line 1', '2nd Dummy Address line 2', '2nd Dummy City', '2nd Dummy County', 'WXX XXZ');

INSERT INTO User (Email, Password, FirstName, LastName, Phone)
VALUES ('notarealemail1@ucl.com', 'password1', 'Dummy FirstName1', 'Dummy LastName1', '000111222333');
INSERT INTO User (Email, Password, FirstName, LastName, Phone)
VALUES ('notarealemail2@ucl.com', 'password2', 'Dummy FirstName2', 'Dummy LastName2', '0001313654');

INSERT INTO Cust_Address (FirstLine, SecondLine, City, County, PostCode)
VALUES ('1st Dummy Address line 1', '1st Dummy Address line 2', '1st Dummy City', '1st Dummy County', 'WXX XXX');
INSERT INTO Cust_Address (FirstLine, SecondLine, City, County, PostCode)
VALUES ('2nd Dummy Address line 1', '2nd Dummy Address line 2', '2nd Dummy City', '2nd Dummy County', 'WXX XXZ');

INSERT INTO FKHost (User_ID, Event_ID)
VALUES(1, 1);
INSERT INTO FKHost (User_ID, Event_ID)
VALUES(2, 2);

INSERT INTO FKEvent_Venue (Event_ID, Address_ID)
VALUES(1, 1);
INSERT INTO FKEvent_Venue (Event_ID, Address_ID)
VALUES(2, 2);

INSERT INTO FKCust_Address (Customer_ID, Cust_Address_ID)
VALUES(1, 1);
INSERT INTO FKCust_Address (Customer_ID, Cust_Address_ID)
VALUES(2, 2);

INSERT INTO FKGuest_List (Event_ID, User_ID)
VALUES(1, 1);
INSERT INTO FKGuest_List (Event_ID, User_ID)
VALUES(2, 2);
